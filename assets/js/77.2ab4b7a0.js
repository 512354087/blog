(window.webpackJsonp=window.webpackJsonp||[]).push([[77],{710:function(s,n,r){"use strict";r.r(n);var a=r(76),e=Object(a.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"sql-综合练习"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#sql-综合练习"}},[s._v("#")]),s._v(" sql 综合练习")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-- 创建 customers 表，用于存储客户信息\nCREATE TABLE IF NOT EXISTS `customers` (\n `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '客户ID，自增长',\n `name` varchar(255) NOT NULL COMMENT '客户姓名，非空',\n PRIMARY KEY (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='客户信息表';\n\n-- 创建 orders 表，用于存储订单信息\nCREATE TABLE IF NOT EXISTS `orders` (\n `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '订单ID，自增长',\n `customer_id` int(11) NOT NULL COMMENT '客户ID，非空',\n `order_date` date NOT NULL COMMENT '订单日期，非空',\n `total_amount` decimal(10,2) NOT NULL COMMENT '订单总金额，非空',\n PRIMARY KEY (`id`),\n FOREIGN KEY (`customer_id`) REFERENCES `customers` (`id`) ON DELETE CASCADE ON UPDATE CASCADE\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='订单信息表';\n\n-- 创建 order_items 表，用于存储订单商品信息\nCREATE TABLE IF NOT EXISTS `order_items` (\n `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '商品ID，自增长',\n `order_id` int(11) NOT NULL COMMENT '订单ID，非空',\n `product_name` varchar(255) NOT NULL COMMENT '商品名称，非空',\n `quantity` int(11) NOT NULL COMMENT '商品数量，非空',\n `price` decimal(10,2) NOT NULL COMMENT '商品单价，非空',\n PRIMARY KEY (`id`),\n FOREIGN KEY (`order_id`) REFERENCES `orders` (`id`) ON DELETE CASCADE ON UPDATE CASCADE\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='订单商品信息表';\n\n\n-- 向 customers 表插入数据\nINSERT INTO `customers` (`name`)\n    VALUES\n        ('张丽娜'),('李明'),('王磊'),('赵静'),('钱伟'),\n        ('孙芳'),('周涛'),('吴洋'),('郑红'),('刘华'),\n        ('陈明'),('杨丽'),('王磊'),('张伟'),('李娜'),\n        ('刘洋'),('陈静'),('杨阳'),('王丽'),('张强');\n\n-- 向 orders 表插入数据\nINSERT INTO `orders` (`customer_id`, `order_date`, `total_amount`)\n    VALUES\n        (1, '2022-01-01',100.00),(1, '2022-01-02',200.00),\n        (2, '2022-01-03',300.00),(2, '2022-01-04',400.00),\n        (3, '2022-01-05',500.00),(3, '2022-01-06',600.00),\n        (4, '2022-01-07',700.00),(4, '2022-01-08',800.00),\n        (5, '2022-01-09',900.00),(5, '2022-01-10',1000.00);\n\n-- 向 order_items 表插入数据\nINSERT INTO `order_items` (`order_id`, `product_name`, `quantity`, `price`)\n    VALUES\n        (1, '耐克篮球鞋',1,100.00),\n        (1, '阿迪达斯跑步鞋',2,50.00),\n        (2, '匡威帆布鞋',3,100.00),\n        (2, '万斯板鞋',4,50.00),\n        (3, '新百伦运动鞋',5,100.00),\n        (3, '彪马休闲鞋',6,50.00),\n        (4, '锐步经典鞋',7,100.00),\n        (5, '亚瑟士运动鞋',10,50.00),\n        (5, '帆布鞋',1,100.00),\n        (1, '苹果手写笔',2,50.00),\n        (2, '电脑包',3,100.00),\n        (3, '苹果手机',4,50.00),\n        (4, '苹果耳机',5,100.00),\n        (5, '苹果平板',7,100.00);\n\n-- 查询每个客户的订单总和\nSELECT SUM(orders.total_amount) as total_amount, customers.name FROM customers INNER JOIN orders ON  customers.id = orders.customer_id GROUP BY customers.id ORDER BY total_amount DESC;\n\n-- 需求 2: 查询每个客户的订单总金额，并计算其占比\nSELECT customers.name, SUM(orders.total_amount) AS total_amount,\n\tSUM(orders.total_amount) / (SELECT SUM(total_amount) FROM orders) AS percentage\n    FROM customers\n    INNER JOIN orders ON customers.id = orders.customer_id\n    GROUP BY customers.id;\n\n-- 需求 3：查询每个客户的订单总金额，并列出每个订单的商品清单\nSELECT customers.name, orders.order_date, orders.total_amount,\n\torder_items.product_name, order_items.quantity, order_items.price\n    FROM customers\n    JOIN orders ON customers.id = orders.customer_id\n    JOIN order_items ON orders.id = order_items.order_id\n    ORDER BY customers.name, orders.order_date;\n\n-- 需求 4：查询每个客户的订单总金额，并列出每个订单的商品清单 同时只显示张姓用户\nSELECT customers.name, orders.order_date, orders.total_amount,\n\torder_items.product_name, order_items.quantity, order_items.price\n    FROM customers\n    JOIN orders ON customers.id = orders.customer_id\n    JOIN order_items ON orders.id = order_items.order_id\n\t\tWHERE customers.name LIKE '张%'\n    ORDER BY customers.name, orders.order_date;\n\n\n-- 需求 5:查询每个客户的订单总金额，并列出每个订单的商品清单，同时只显示订单日期在2022年1月1日到2022年1月3日之间的记录\nSELECT customers.name, orders.order_date, orders.total_amount,\n\torder_items.product_name, order_items.quantity, order_items.price\n    FROM customers\n    JOIN orders ON customers.id = orders.customer_id\n    JOIN order_items ON orders.id = order_items.order_id\n\t\tWHERE orders.order_date BETWEEN '2022-01-01' AND '2022-01-03'\n    ORDER BY customers.name, orders.order_date;\n\n-- 需求 6:查询每个客户的订单总金额，并计算商品数量，只包含商品名称包含“鞋”的商品，商品名用-连接，显示前 3 条记录：\nSELECT customers.name, SUM(orders.total_amount) AS total_amount, GROUP_CONCAT(order_items.product_name SEPARATOR '-') AS product_names, COUNT(order_items.id) AS total_quantity, SUM(order_items.quantity) AS all_order_item_quantity  FROM customers\n    JOIN orders ON customers.id = orders.customer_id\n    JOIN order_items ON orders.id = order_items.order_id\n\t\tWHERE order_items.product_name LIKE '%鞋%'\n\t\tGROUP BY customers.name\n\t\tLIMIT 3 OFFSET 0;\n\n-- 需求 7: 查询存在订单的客户\nSELECT * FROM customers  WHERE EXISTS (\n        SELECT * FROM orders WHERE customers.id = orders.customer_id\n    );\n\n-- 需求 8: 将王磊的订单总金额打九折\nUPDATE orders o SET o.total_amount = o.total_amount * 0.9\n    WHERE o.customer_id IN (\n        SELECT id FROM customers WHERE name = '王磊'\n    );\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br"),n("span",{staticClass:"line-number"},[s._v("114")]),n("br"),n("span",{staticClass:"line-number"},[s._v("115")]),n("br"),n("span",{staticClass:"line-number"},[s._v("116")]),n("br"),n("span",{staticClass:"line-number"},[s._v("117")]),n("br"),n("span",{staticClass:"line-number"},[s._v("118")]),n("br"),n("span",{staticClass:"line-number"},[s._v("119")]),n("br"),n("span",{staticClass:"line-number"},[s._v("120")]),n("br")])])])}),[],!1,null,null,null);n.default=e.exports}}]);